{% extends "auctions/layout.html" %}

{% block body %}
    <div class="error_div">
        {% if listing.status is False %}
            <div class="alert alert-secondary" role="alert">This listing has ended. {% if is_leader is True %}You won!{% endif %}</div>
        {% endif %}
        <h2 class="listing-title">{{ listing.title }}</h2>
        {% if bid_errors %}
            {% for error in bid_errors %}
                <div class="alert alert-danger" role="alert">{{ error }}</div>
            {% endfor %}
        {% endif %}
    </div>
    <div class="d-flex flex-wrap justify-content-center">
        <div class="flex-grid-0th ml-3">
            <form action="{% url 'listings' listing.id %}" novalidate method="POST">
                {% csrf_token %}
                <button type="submit" name="watch_button" class="btn {% if wl_check is False %}btn-secondary{% else %}btn-success{% endif %} btn-sm mb-3" value="WATCHLIST">WATCHLIST</button>
            </form>
            <img src="{{ listing.img_url }}" alt="MISSING IMAGE" class="listing-img">
        </div>
        <div class="flex-grid-1st flex-grid-bid-form ml-3">
            <h3>Current price for this listing is <span class="bid-text">${{ listing.price }}</span>.</h3>
            <p>Listed by {{ listing.seller }}.</p>
            {% if listing.status is True %}
                <span>{{ bid_count }} bid(s) so far. {% if is_leader is True %} <span class="leader-text">You are the current bid leader.</span>{% endif %}</span>
                <form action="{% url 'listings' listing.id %}" method="POST">
                    {% csrf_token %}
                    {% include "auctions/form_snippet.html" %}
                    <button type="submit" name="bid_button" class="btn btn-primary" value="Place Bid">Place Bid</button>
                </form>
                {% if seller_check is True %}
                    <form action="{% url 'listings' listing.id %}" novalidate method="POST">
                        {% csrf_token %}
                        <button type="submit" name="close_button" class="mt-3 btn btn-danger" value="End this listing">End this listing</button>
                    </form>
                {% endif %}
            {% endif %}
            <p>{{ listing.description }}</p>
        </div>
        <div id="comment-form-ctn" class="flex-grid-0th comment-margin">
            <form class="comment-form" action="{% url 'listings' listing.id %}" method="POST">
                {% csrf_token %}
                {% include "auctions/comment_snippet.html" %}
                <button type="submit" name="comment_button" class="mt-1 btn btn-primary" value="Submit Comment">Submit Comment</button>
            </form>
        </div>
        <div class="flex-grid-1st flex-grid-comments {% if comments %}comment-margin{% else %}no-comment-margin{% endif %}">
            <h3>Comments</h3>
            {% if comments %}
                {% for comment in comments %}
                    <div class="comment-ctn mb-3">
                        <div class="user-ctn">
                            <p class="font-weight-bold">{{ comment.user }}</p>
                        </div>
                        <div class="content-ctn">
                            <p>{{ comment.content }}</p>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <div class="alert alert-secondary mt-3" role="alert">Be the first one to submit a comment on this listing!</div>
            {% endif %}
        </div>
    </div>
{% endblock %}
